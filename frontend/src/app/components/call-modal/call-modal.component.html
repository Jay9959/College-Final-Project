<div class="call-overlay" *ngIf="callActive || incomingCall">
    <!-- Incoming Call Modal -->
    <div class="incoming-call-modal animate-scale-in" *ngIf="incomingCall && !callActive">
        <div class="caller-info">
            <div class="avatar-ring">
                <div class="avatar">
                    {{ callerName.charAt(0).toUpperCase() }}
                </div>
            </div>
            <h3>{{ callerName }}</h3>
            <p>Incoming Video Call...</p>
        </div>
        <div class="call-actions">
            <button class="btn-decline" (click)="declineCall()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Decline
            </button>
            <button class="btn-answer" (click)="acceptCall()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                    </path>
                </svg>
                Answer
            </button>
        </div>
    </div>

    <!-- Active Call Interface -->
    <div class="active-call-container animate-fade-in" *ngIf="callActive">
        <!-- Video Mode -->
        <ng-container *ngIf="callType === 'video'">
            <video #remoteVideo autoplay playsinline class="remote-video"></video>
            <video #localVideo autoplay playsinline muted class="local-video" [style.filter]="selectedFilter"></video>
        </ng-container>

        <!-- Audio Mode -->
        <div *ngIf="callType === 'audio'" class="audio-call-ui">
            <div class="audio-avatar-ring">
                <div class="audio-avatar">
                    {{ callerName.charAt(0).toUpperCase() }}
                </div>
            </div>
            <h3>{{ callerName }}</h3>
            <p>Voice Call</p>
            <audio #remoteVideo autoplay></audio> <!-- Still needed for audio track, but hidden or styled -->
        </div>

        <!-- Filter Menu -->
        <div class="filter-menu animate-scale-in" *ngIf="showFilterMenu && callType === 'video'">
            <div class="filter-options">
                <button *ngFor="let filter of availableFilters" class="filter-btn"
                    [class.active]="selectedFilter === filter.value" (click)="applyFilter(filter.value)">
                    {{ filter.name }}
                </button>
            </div>
        </div>

        <div class="call-controls">
            <!-- Filter Button (only for video) -->
            <button class="control-btn" *ngIf="callType === 'video'" [class.active]="showFilterMenu"
                (click)="toggleFilterMenu()" title="Filters">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                </svg>
            </button>

            <button class="control-btn" [class.active]="!audioEnabled" (click)="toggleAudio()">
                <svg *ngIf="audioEnabled" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
                <svg *ngIf="!audioEnabled" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                    <path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path>
                    <path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>

            <button class="control-btn hangup-btn" (click)="hangup()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                    <path
                        d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" />
                </svg>
            </button>

            <button class="control-btn" [class.active]="!videoEnabled" (click)="toggleVideo()">
                <svg *ngIf="videoEnabled" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <polygon points="23 7 16 12 23 17 23 7"></polygon>
                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                </svg>
                <svg *ngIf="!videoEnabled" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path
                        d="M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10">
                    </path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
            </button>
        </div>
    </div>
</div>