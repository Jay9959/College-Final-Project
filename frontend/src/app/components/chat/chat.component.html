<div class="chat-container">
    <!-- Sidebar -->
    <aside class="sidebar" [class.mobile-hidden]="selectedUser">
        <div class="sidebar-header">
            <div class="user-info">
                <input type="file" #fileInput style="display: none" (change)="onFileSelected($event)" accept="image/*">

                <div class="avatar-container" (click)="fileInput.click()" title="Change Profile Picture">
                    <div *ngIf="!currentUser?.avatar" class="avatar">
                        {{ currentUser?.username?.charAt(0)?.toUpperCase() }}
                    </div>
                    <img *ngIf="currentUser?.avatar" [src]="getAvatarUrl(currentUser?.avatar)" class="avatar-img"
                        alt="{{ currentUser?.username }}" (error)="onAvatarError()">

                    <div class="edit-overlay">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                            </path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                    </div>
                </div>
                <span class="username">{{ currentUser?.fullName || currentUser?.username }}</span>
            </div>


            <div class="header-actions">
                <button class="icon-btn" (click)="openSettings()" title="Settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>

            </div>
        </div>

        <div class="search-box">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input type="text" placeholder="Search or start new chat" [(ngModel)]="searchQuery">
        </div>

        <div class="users-list">
            <div *ngFor="let user of filteredUsers" class="user-item" [class.active]="selectedUser?._id === user._id"
                (click)="selectUser(user)">
                <div class="user-avatar">
                    <ng-container *ngIf="!user.avatar">
                        {{ user.username.charAt(0).toUpperCase() }}
                    </ng-container>
                    <img *ngIf="user.avatar" [src]="getAvatarUrl(user.avatar)" class="avatar-img"
                        style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;"
                        (error)="user.avatar = undefined">
                    <span class="status-dot" [class.online]="isUserOnline(user._id)"></span>
                </div>
                <div class="user-details">
                    <div class="user-name">{{ user.fullName || user.username }}</div>
                    <div class="user-status">{{ isUserOnline(user._id) ? 'Online' : 'Offline' }}</div>
                </div>
            </div>
            <div *ngIf="users.length === 0" class="no-users">
                <p>No users found</p>
                <small>Invite friends to chat!</small>
            </div>
        </div>
    </aside>

    <!-- Chat Area -->
    <main class="chat-area" [class.mobile-show]="selectedUser">
        <div *ngIf="!selectedUser" class="no-chat">
            <div class="no-chat-content animate-fade-in">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="url(#gradient)" stroke-width="1.5">
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">
                            <stop offset="0%" stop-color="#3b82f6" />
                            <stop offset="100%" stop-color="#8b5cf6" />
                        </linearGradient>
                    </defs>
                    <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                    </path>
                </svg>
                <h2>Chat</h2>
                <p>Select a conversation to start messaging.</p>
            </div>
        </div>

        <ng-container *ngIf="selectedUser">
            <div class="chat-header">
                <div class="chat-user-info-group">
                    <button class="back-btn" (click)="deselectUser()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="m15 18-6-6 6-6" />
                        </svg>
                    </button>

                    <div class="chat-user-avatar">
                        <img *ngIf="selectedUser.avatar" [src]="getAvatarUrl(selectedUser.avatar)"
                            style="width:100%; height:100%; border-radius:14px; object-fit:cover;">
                        <span *ngIf="!selectedUser.avatar">{{ selectedUser.username.charAt(0).toUpperCase() }}</span>
                    </div>

                    <div class="chat-user-text">
                        <div class="chat-user-name">{{ selectedUser.fullName || selectedUser.username }}</div>
                        <div class="chat-user-status">
                            <span *ngIf="typingUsers[selectedUser._id]" class="typing-indicator">typing...</span>
                            <span *ngIf="!typingUsers[selectedUser._id] && isUserOnline(selectedUser._id)">
                                <span class="online-indicator"></span> Online
                            </span>
                            <span
                                *ngIf="!typingUsers[selectedUser._id] && !isUserOnline(selectedUser._id)">Offline</span>
                        </div>
                    </div>

                    <!-- Call Buttons -->
                    <div class="call-actions">
                        <button class="call-btn" (click)="onVoiceCall()" title="Voice Call">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                                </path>
                            </svg>
                        </button>
                        <button class="call-btn" (click)="onVideoCall()" title="Video Call">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Call Modal Component -->
            <app-call-modal #callModal [currentUser]="currentUser"></app-call-modal>

            <div class="messages-container" #messagesContainer>
                <div *ngFor="let message of messages" class="message"
                    [class.sent]="message.sender._id === currentUser?._id"
                    [class.received]="message.sender._id !== currentUser?._id">
                    <div class="message-bubble">
                        <!-- Text Message -->
                        <p *ngIf="message.messageType === 'text' || !message.messageType" class="message-text">{{
                            message.content }}</p>

                        <!-- Image Message -->
                        <div *ngIf="message.messageType === 'image'" class="message-image">
                            <img [src]="getAvatarUrl(message.fileUrl)" alt="Image"
                                style="max-width: 150px; max-height: 200px; object-fit: cover; border-radius: 12px; cursor: pointer;">
                        </div>

                        <!-- Video Message -->
                        <div *ngIf="message.messageType === 'video'" class="message-video">
                            <video controls [src]="getAvatarUrl(message.fileUrl)"
                                style="max-width: 250px; max-height: 250px; border-radius: 12px;"></video>
                        </div>

                        <!-- Generic File Message -->
                        <div *ngIf="message.messageType === 'file'" class="message-file"
                            style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px;">
                            <a [href]="getAvatarUrl(message.fileUrl)" target="_blank"
                                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 10px;">
                                <div class="file-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                        <polyline points="13 2 13 9 20 9"></polyline>
                                    </svg>
                                </div>
                                <div class="file-info" style="display: flex; flex-direction: column;">
                                    <span class="file-name" style="font-weight: 500;">{{ message.content }}</span>
                                    <span class="file-label" style="font-size: 0.8em; opacity: 0.8;">Click to
                                        open</span>
                                </div>
                            </a>
                        </div>

                        <!-- Audio Message -->
                        <div *ngIf="message.messageType === 'audio'" class="message-audio">
                            <audio controls [src]="getAvatarUrl(message.fileUrl)" style="max-width: 200px;"></audio>
                        </div>

                        <!-- Call Log Message -->
                        <div class="call-log-bubble" *ngIf="message.messageType === 'call_log'" (click)="onVideoCall()">
                            <div class="call-log-icon" [class.missed]="message.content?.includes('Missed')"
                                [class.ended]="!message.content?.includes('Missed')">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" *ngIf="message.content?.includes('Missed')">
                                    <path d="M23 7l-7 5 7 5V7z"></path>
                                    <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                    <line x1="1" y1="1" x2="23" y2="23" stroke="currentColor" stroke-width="2"></line>
                                    <!-- Simple strikethrough or arrow -->
                                </svg>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" *ngIf="!message.content?.includes('Missed')">
                                    <path
                                        d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                                    </path>
                                </svg>
                            </div>
                            <div class="call-log-content">
                                <div class="call-log-title">{{ message.content }}</div>
                                <div class="call-log-subtitle">{{ message.content?.includes('Missed') ? 'Click to call
                                    back' : 'Tap to call again' }}</div>
                            </div>
                        </div>

                        <div class="message-meta">
                            <span class="message-time">{{ formatTime(message.createdAt) }}</span>
                            <span *ngIf="message.sender._id === currentUser?._id && !message.uploadProgress"
                                class="message-status">
                                <span *ngIf="message.seen" class="tick seen">✓✓</span>
                                <span *ngIf="!message.seen && message.delivered" class="tick delivered">✓✓</span>
                                <span *ngIf="!message.seen && !message.delivered" class="tick">✓</span>
                            </span>
                        </div>

                        <!-- Upload Progress Overlay -->
                        <div *ngIf="message.uploadProgress !== undefined" class="upload-overlay"
                            style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); border-radius: inherit; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                            <div class="spinner"
                                style="width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-bottom: 5px;">
                            </div>
                            <span style="color: white; font-size: 0.7em; font-weight: bold;">{{ message.uploadProgress
                                }}%</span>
                        </div>
                    </div>
                </div>
                <div *ngIf="messages.length === 0" class="no-messages"
                    style="text-align:center; color:rgba(255,255,255,0.3); margin-top:40px;">
                    <p>No messages yet</p>
                    <small>Start the conversation!</small>
                </div>
            </div>

            <div class="message-input-container">
                <!-- Emoji Picker -->
                <div *ngIf="showEmojiPicker" class="emoji-picker">
                    <span *ngFor="let emoji of emojis" (click)="addEmoji(emoji)">{{ emoji }}</span>
                </div>

                <div class="input-wrapper">
                    <button class="action-btn" (click)="chatFileInput.click()" title="Attach File">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 5v14M5 12h14" />
                        </svg>
                    </button>
                    <!-- Separate input for chat files -->
                    <input type="file" #chatFileInput style="display: none" (change)="onChatFileSelected($event)">

                    <button class="action-btn" (click)="toggleEmojiPicker()" title="Emoji">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                        </svg>
                    </button>

                    <input type="text" [placeholder]="isRecording ? 'Recording audio...' : 'Type your message...'"
                        [(ngModel)]="newMessage" (keyup.enter)="sendMessage()" (input)="onTyping()"
                        [disabled]="isRecording">

                    <!-- Mic / Stop Button -->
                    <button class="action-btn" *ngIf="!newMessage.trim()"
                        (click)="isRecording ? stopRecording() : startRecording()"
                        [title]="isRecording ? 'Stop Recording' : 'Record Audio'"
                        [style.color]="isRecording ? '#ef4444' : ''"
                        [style.animation]="isRecording ? 'pulse 1.5s infinite' : ''">
                        <svg *ngIf="!isRecording" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                        <svg *ngIf="isRecording" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <rect x="6" y="6" width="12" height="12" rx="2" fill="currentColor"></rect>
                        </svg>
                    </button>

                    <!-- Send Button (only when text present) -->
                    <button class="send-btn" *ngIf="newMessage.trim()" (click)="sendMessage()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
            </div>
        </ng-container>
    </main>

    <!-- File Preview Modal -->
    <div class="modal-overlay" *ngIf="previewFile">
        <div class="preview-modal animate-scale-in">
            <div class="preview-header">
                <h3>Send Attachment?</h3>
                <button class="close-btn" (click)="cancelPreview()">×</button>
            </div>

            <div class="preview-content">
                <img *ngIf="previewUrl && previewFile?.type?.startsWith('image/')" [src]="previewUrl" alt="Preview">
                <video *ngIf="previewUrl && previewFile?.type?.startsWith('video/')" [src]="previewUrl" controls
                    style="max-width: 100%; max-height: 300px;"></video>
                <div *ngIf="!previewUrl" class="file-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                        <polyline points="13 2 13 9 20 9"></polyline>
                    </svg>
                    <span>{{ previewFile.name }}</span>
                    <small>{{ (previewFile.size / 1024 / 1024).toFixed(2) }} MB</small>
                </div>
            </div>

            <div class="preview-actions">
                <button class="cancel-btn" (click)="cancelPreview()">Cancel</button>
                <button class="confirm-btn" (click)="confirmSendFile()">
                    Send
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>


    <!-- Advanced Settings Modal -->
    <div class="settings-overlay" *ngIf="showSettings" (click)="closeSettings()">
        <div class="settings-modal animate-scale-in" (click)="$event.stopPropagation()">

            <!-- MAIN VIEW -->
            <ng-container *ngIf="settingsView === 'main'">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>

                <div class="setting-search-container">
                    <input type="text" class="settings-search" placeholder="Search settings">
                </div>

                <div class="settings-content">
                    <!-- Profile Card -->
                    <div class="settings-profile-card">
                        <div class="profile-avatar-large">
                            <img *ngIf="currentUser?.avatar" [src]="getAvatarUrl(currentUser?.avatar)"
                                style="width: 100%; height: 100%; object-fit: cover;">
                            <div *ngIf="!currentUser?.avatar"
                                style="width: 100%; height: 100%; background: #6366f1; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white;">
                                {{ currentUser?.username?.charAt(0)?.toUpperCase() }}
                            </div>
                        </div>
                        <div class="profile-info">
                            <h3>{{ currentUser?.fullName || currentUser?.username }}</h3>
                            <p class="profile-status">Busy doing nothing...</p>
                        </div>
                    </div>

                    <!-- Menu List -->
                    <div class="settings-menu">
                        <!-- General -->
                        <div class="menu-item" (click)="navigateToSettings('general')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="3" y1="9" x2="21" y2="9"></line>
                            </svg>
                            <div class="menu-text">
                                <h4>General</h4>
                                <p>Startup and close</p>
                            </div>
                        </div>

                        <!-- Account -->
                        <div class="menu-item" (click)="navigateToSettings('account')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4">
                                </path>
                            </svg>
                            <div class="menu-text">
                                <h4>Account</h4>
                                <p>Security notifications, account info</p>
                            </div>
                        </div>

                        <!-- Privacy -->
                        <div class="menu-item" (click)="navigateToSettings('privacy')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            <div class="menu-text">
                                <h4>Privacy</h4>
                                <p>Blocked contacts, disappearing messages</p>
                            </div>
                        </div>

                        <!-- Chats -->
                        <div class="menu-item" (click)="navigateToSettings('chats')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <div class="menu-text">
                                <h4>Chats</h4>
                                <p>Theme, wallpaper, chat settings</p>
                            </div>
                        </div>

                        <!-- Video & Voice -->
                        <div class="menu-item" (click)="navigateToSettings('video-voice')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                            <div class="menu-text">
                                <h4>Video & voice</h4>
                                <p>Camera, microphone & speakers</p>
                            </div>
                        </div>

                        <!-- Video & Voice -->
                        <div class="menu-item">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                            </svg>
                            <div class="menu-text">
                                <h4>Video & voice</h4>
                                <p>Camera, microphone & speakers</p>
                            </div>
                        </div>

                        <!-- Notifications -->
                        <div class="menu-item">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            <div class="menu-text">
                                <h4>Notifications</h4>
                                <p>Message notifications</p>
                            </div>
                        </div>

                        <!-- Logout -->
                        <div class="menu-item logout-item" (click)="onLogout()">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16,17 21,12 16,7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            <div class="menu-text">
                                <h4>Log out</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- CHATS VIEW -->
            <ng-container *ngIf="settingsView === 'chats'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('main')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Chats
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">

                    <!-- Display Section -->
                    <div class="settings-section">
                        <h3>Display</h3>

                        <!-- Theme -->
                        <div class="setting-row" (click)="openThemeModal()">
                            <div class="setting-info">
                                <h4>Theme</h4>
                                <p>{{ chatSettings.theme }}</p>
                            </div>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                            <!-- No chevron implies action, or maybe keep it? Screenshot shows chevron in other rows but maybe not this one? 
                               Actually screenshot of Chats view usually shows current value. 
                               Let's keep text and maybe chevron if it opens a dialog. -->
                        </div>

                        <!-- Wallpaper -->
                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Wallpaper</h4>
                            </div>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <div class="divider"></div>
                    </div>

                    <!-- Chat Settings Section -->
                    <div class="settings-section">
                        <h3>Chat settings</h3>

                        <!-- Media upload quality -->
                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Media upload quality</h4>
                            </div>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <!-- Media auto-download -->
                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Media auto-download</h4>
                            </div>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <div class="divider"></div>

                        <!-- Spell Check -->
                        <div class="checkbox-row">
                            <div class="checkbox-info">
                                <h4>Spell check</h4>
                                <p>Check spelling while typing</p>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input" [(ngModel)]="chatSettings.spellCheck"
                                    (change)="saveSettings()">
                                <span class="switch-slider"></span>
                            </label>
                        </div>

                        <!-- Replace text with emoji -->
                        <div class="checkbox-row">
                            <div class="checkbox-info">
                                <h4>Replace text with emoji</h4>
                                <p>Emoji will replace specific text as you type</p>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input" [(ngModel)]="chatSettings.replaceEmoji"
                                    (change)="saveSettings()">
                                <span class="switch-slider"></span>
                            </label>
                        </div>

                        <!-- Enter is send -->
                        <div class="checkbox-row">
                            <div class="checkbox-info">
                                <h4>Enter is send</h4>
                                <p>Enter key will send your message</p>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input" [(ngModel)]="chatSettings.enterIsSend"
                                    (change)="saveSettings()">
                                <span class="switch-slider"></span>
                            </label>
                        </div>

                    </div>
                </div>
            </ng-container>

            <!-- GENERAL SETTINGS VIEW -->
            <ng-container *ngIf="settingsView === 'general'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('main')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        General
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">

                    <!-- Startup and close -->
                    <div class="settings-section">
                        <h3>Startup and close</h3>

                        <div class="checkbox-row">
                            <div class="checkbox-info">
                                <h4>Start WhatsApp at login</h4>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input" [(ngModel)]="generalSettings.startAtLogin">
                                <span class="switch-slider"></span>
                            </label>
                        </div>

                        <div class="checkbox-row">
                            <div class="checkbox-info">
                                <h4>Minimise to system tray</h4>
                                <p>Keep WhatsApp running after closing the application window</p>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input"
                                    [(ngModel)]="generalSettings.minimizeToTray">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Language -->
                    <div class="settings-section">
                        <h3>Language</h3>
                        <div class="styled-select-container">
                            <select class="styled-select" [(ngModel)]="generalSettings.language">
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Gujarati">Gujarati</option>
                            </select>
                        </div>
                    </div>

                    <!-- Font size -->
                    <div class="settings-section">
                        <h3>Font size</h3>
                        <div class="styled-select-container">
                            <select class="styled-select" [(ngModel)]="generalSettings.fontSize"
                                (change)="applyFontSize()">
                                <option value="100% (default)">100% (default)</option>
                                <option value="125%">125%</option>
                                <option value="150%">150%</option>
                            </select>
                            <span class="help-text">Use Ctrl + / - to increase or decrease text size</span>
                        </div>
                    </div>

                </div>
            </ng-container>

            <!-- ACCOUNT SETTINGS VIEW -->
            <ng-container *ngIf="settingsView === 'account'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('main')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Account
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">
                    <div class="settings-menu">
                        <!-- Security notifications -->
                        <div class="menu-item" (click)="navigateToSettings('security')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            <div class="menu-text">
                                <h4>Security notifications</h4>
                            </div>
                        </div>

                        <!-- Request account info -->
                        <div class="menu-item" (click)="navigateToSettings('request-info')">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            <div class="menu-text">
                                <h4>Request account info</h4>
                            </div>
                        </div>

                        <!-- Delete account -->
                        <div class="menu-item">
                            <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <div class="menu-text">
                                <h4>How to delete my account</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- SECURITY VIEW -->
            <ng-container *ngIf="settingsView === 'security'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('account')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Security
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">
                    <div class="security-hero">
                        <svg class="security-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" fill="#10b981" fill-opacity="0.1">
                            </rect>
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <h3>Your chats and calls are private</h3>
                        <p>End-to-end encryption keeps your personal messages and calls between you and the people you
                            choose. No one outside of the chat, not even WhatsApp, can read, listen to, or share them.
                            This
                            includes your:</p>
                    </div>

                    <div class="privacy-list">
                        <div class="privacy-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            Text and voice messages
                        </div>
                        <div class="privacy-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                                </path>
                            </svg>
                            Audio and video calls
                        </div>
                        <div class="privacy-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            Photos, videos and documents
                        </div>
                        <div class="privacy-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Location sharing
                        </div>
                        <div class="privacy-item">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="6"></circle>
                            </svg>
                            Status updates
                        </div>

                        <a class="learn-more">Learn more</a>
                    </div>

                    <div class="security-footer">
                        <div class="checkbox-row">
                            <div class="checkbox-info">
                                <h4>Show security notifications on this computer</h4>
                                <p style="margin-bottom: 8px;">Get notified when your security code changes for a
                                    contact's
                                    phone. If you have multiple devices, this setting must be enabled on each device
                                    where
                                    you want to get notifications.</p>
                                <a class="learn-more">Learn more</a>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input"
                                    [(ngModel)]="securitySettings.showNotifications">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- REQUEST INFO VIEW -->
            <ng-container *ngIf="settingsView === 'request-info'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('account')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Request account info
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>Account information</h3>
                        <div class="info-card">
                            <div class="info-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                            </div>
                            <div class="info-text">
                                <h4>Request sent</h4>
                                <p>Ready by January 31, 2026</p>
                            </div>
                        </div>
                        <p class="help-text"
                            style="color: #94a3b8; font-size: 13px; line-height: 1.5; margin-bottom: 32px;">
                            Your request will be cancelled if you make changes to your account such as changing your
                            number
                            or deleting your account.
                        </p>

                        <h3>Channels activity</h3>
                        <div class="report-item">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            <span>Request Channels report</span>
                        </div>

                        <p class="help-text"
                            style="color: #94a3b8; font-size: 13px; line-height: 1.5; margin-top: 24px;">
                            Create a report of updates and information from channels you interact with or manage, which
                            you
                            can access or port to another app. <a class="learn-more">Learn more</a>
                        </p>
                    </div>
                </div>
            </ng-container>

            <!-- PRIVACY VIEW -->
            <ng-container *ngIf="settingsView === 'privacy'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('main')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Privacy
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">

                    <!-- Section 1: Who can see my personal info -->
                    <div class="settings-section">
                        <h3 class="section-title">Who can see my personal info</h3>

                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Last seen and online</h4>
                                <p>{{ privacySettings.lastSeen }}</p>
                            </div>
                            <select class="hidden-select" [(ngModel)]="privacySettings.lastSeen"
                                (change)="saveSettings()">
                                <option value="Everyone">Everyone</option>
                                <option value="My contacts">My contacts</option>
                                <option value="Nobody">Nobody</option>
                            </select>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Profile photo</h4>
                                <p>{{ privacySettings.profilePhoto }}</p>
                            </div>
                            <select class="hidden-select" [(ngModel)]="privacySettings.profilePhoto"
                                (change)="saveSettings()">
                                <option value="Everyone">Everyone</option>
                                <option value="My contacts">My contacts</option>
                                <option value="Nobody">Nobody</option>
                            </select>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>About</h4>
                                <p>{{ privacySettings.about }}</p>
                            </div>
                            <select class="hidden-select" [(ngModel)]="privacySettings.about" (change)="saveSettings()">
                                <option value="Everyone">Everyone</option>
                                <option value="My contacts">My contacts</option>
                                <option value="Nobody">Nobody</option>
                            </select>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Status</h4>
                                <p>{{ privacySettings.status }}</p>
                            </div>
                            <select class="hidden-select" [(ngModel)]="privacySettings.status"
                                (change)="saveSettings()">
                                <option value="My contacts">My contacts</option>
                                <option value="My contacts except...">My contacts except...</option>
                                <option value="Only share with...">Only share with...</option>
                            </select>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <div class="setting-row no-hover">
                            <div class="setting-info">
                                <h4>Read receipts</h4>
                                <p class="description">If turned off, you won't send or receive read receipts. Read
                                    receipts
                                    are always sent for group chats.</p>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input" [(ngModel)]="privacySettings.readReceipts"
                                    (change)="saveSettings()">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <hr class="divider">

                    <!-- Section 2: Disappearing messages -->
                    <div class="settings-section">
                        <h3 class="section-title">Disappearing messages</h3>
                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Default message timer</h4>
                                <p>{{ privacySettings.defaultTimer }}</p>
                            </div>
                            <select class="hidden-select" [(ngModel)]="privacySettings.defaultTimer"
                                (change)="saveSettings()">
                                <option value="Off">Off</option>
                                <option value="24 Hours">24 Hours</option>
                                <option value="7 Days">7 Days</option>
                                <option value="90 Days">90 Days</option>
                            </select>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </div>

                    <hr class="divider">

                    <!-- Section 3: Groups & App Lock -->
                    <div class="settings-section">
                        <div class="setting-row">
                            <div class="setting-info">
                                <h4>Groups</h4>
                                <p>{{ privacySettings.groups }}</p>
                            </div>
                            <select class="hidden-select" [(ngModel)]="privacySettings.groups"
                                (change)="saveSettings()">
                                <option value="Everyone">Everyone</option>
                                <option value="My contacts">My contacts</option>
                                <option value="My contacts except...">My contacts except...</option>
                            </select>
                            <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>

                        <!-- Blocked contacts skipped as requested -->

                        <div class="setting-row" (click)="navigateToSettings('app-lock')">
                            <div class="setting-info">
                                <h4>App lock</h4>
                                <p class="description">Require password to unlock WhatsApp</p>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span style="color: #94a3b8; font-size: 14px; margin-right: 8px;">{{
                                    privacySettings.appLock
                                    ? 'Enabled' : 'Disabled' }}</span>
                                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <hr class="divider">

                    <!-- Section 4: Advanced -->
                    <div class="settings-section">
                        <h3 class="section-title">Advanced</h3>
                        <div class="setting-row no-hover">
                            <div class="setting-info">
                                <h4>Block unknown account messages</h4>
                                <p class="description">To protect your account and improve device performance, WhatsApp
                                    will
                                    block messages from unknown accounts if they exceed a certain volume. <a
                                        class="learn-more">Learn more</a></p>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input"
                                    [(ngModel)]="privacySettings.blockUnknownMessages" (change)="saveSettings()">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                </div>
            </ng-container>

            <!-- VIDEO & VOICE VIEW -->
            <ng-container *ngIf="settingsView === 'video-voice'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('main')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Video & voice
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">
                    <div class="settings-section">
                        <h3>Camera</h3>
                        <select class="styled-select" [(ngModel)]="videoSettings.cameraDeviceId"
                            (change)="saveSettings()">
                            <option value="" disabled selected>Select Camera</option>
                            <option *ngFor="let device of videoInputDevices" [value]="device.deviceId">{{ device.label
                                }}
                            </option>
                        </select>

                        <h3>Microphone</h3>
                        <select class="styled-select" [(ngModel)]="videoSettings.micDeviceId" (change)="saveSettings()">
                            <option value="" disabled selected>Select Microphone</option>
                            <option *ngFor="let device of audioInputDevices" [value]="device.deviceId">{{ device.label
                                }}
                            </option>
                        </select>

                        <h3>Speakers</h3>
                        <select class="styled-select" [(ngModel)]="videoSettings.speakerDeviceId"
                            (change)="saveSettings()">
                            <option value="" disabled selected>Select Speakers</option>
                            <option *ngFor="let device of audioOutputDevices" [value]="device.deviceId">{{ device.label
                                }}
                            </option>
                        </select>
                    </div>
                </div>
            </ng-container>

            <!-- APP LOCK VIEW -->
            <ng-container *ngIf="settingsView === 'app-lock'">
                <div class="settings-header">
                    <button class="back-btn" (click)="navigateToSettings('privacy')">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        App lock
                    </button>
                    <button class="close-btn" (click)="closeSettings()">×</button>
                </div>
                <div class="settings-content">
                    <div class="lock-hero">
                        <div class="lock-icon-container">
                            <svg class="lock-icon-large" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 2C9.243 2 7 4.243 7 7v3H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-1V7c0-2.757-2.243-5-5-5zm6 10v8H6v-8h12zm-9-5V7c0-1.654 1.346-3 3-3s3 1.346 3 3v3H9z" />
                            </svg>
                            <div class="lock-badge">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </div>
                        </div>
                        <h2 class="lock-title">Lock with a password</h2>
                        <p class="lock-description">
                            You can lock WhatsApp instead of logging out. This makes it easier to access again later. <a
                                class="learn-more">Learn more</a>
                        </p>
                    </div>

                    <div class="settings-section">
                        <div class="setting-row no-hover">
                            <div class="setting-info">
                                <h4>Enable app lock</h4>
                            </div>
                            <label class="switch-container">
                                <input type="checkbox" class="switch-input" [(ngModel)]="privacySettings.appLock"
                                    (change)="toggleAppLock($event)">
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="lock-footer">
                        <p>When app lock is enabled you can lock WhatsApp from the Chats menu.</p>
                        <p>You won't get notifications when WhatsApp is locked. App lock will reset if you log out.</p>
                    </div>
                </div>
            </ng-container>

        </div>
    </div><!-- Set Password Modal -->
    <div class="modal-overlay" *ngIf="showSetPasswordModal">
        <div class="set-password-modal animate-scale-in">
            <h2>Set password</h2>

            <div class="input-group">
                <label>Enter password</label>
                <input type="password" [(ngModel)]="tempPassword" placeholder="Enter password" class="password-input">
                <div class="input-line"></div>
            </div>

            <div class="input-group">
                <label>Re-enter password</label>
                <input type="password" [(ngModel)]="tempConfirmPassword" placeholder="Re-enter password"
                    class="password-input">
                <div class="input-line"></div>
            </div>

            <p class="password-hint">
                Password must be 6-128 characters, and may only contain letters, numbers, and common punctuation
            </p>

            <div class="modal-actions">
                <button class="cancel-text-btn" (click)="closeSetPasswordModal()">Cancel</button>
                <button class="ok-btn" (click)="confirmSetPassword()">OK</button>
            </div>
        </div>
    </div>

    <!-- Password Set Success Modal -->
    <div class="modal-overlay" *ngIf="showPasswordSetModal">
        <div class="password-set-modal animate-scale-in">
            <h2>Password set</h2>

            <p class="success-text">You can lock WhatsApp from the Chats menu.</p>
            <p class="success-text sub">Update app lock anytime in Settings > Privacy > App lock.</p>

            <div class="modal-actions-spread">
                <button class="done-text-btn" (click)="closePasswordSetModal()">Done</button>
                <button class="lock-now-btn" (click)="lockApp()">Lock now</button>
            </div>
        </div>
    </div>

    <!-- Locked Screen Overlay -->
    <div class="locked-overlay" *ngIf="isAppLocked">
        <div class="locked-content animate-fade-in">
            <div class="locked-avatar">
                <img *ngIf="currentUser?.avatar" [src]="getAvatarUrl(currentUser?.avatar)" alt="Avatar">
                <div *ngIf="!currentUser?.avatar" class="default-initial">{{
                    currentUser?.username?.charAt(0)?.toUpperCase()
                    }}</div>
            </div>

            <h2 class="locked-username">{{ currentUser?.fullName || currentUser?.username }}</h2>

            <p class="locked-message">App lock is on. Enter your password to use WhatsApp Windows.</p>

            <div class="unlock-input-wrapper">
                <input [type]="isPasswordVisible ? 'text' : 'password'" [(ngModel)]="unlockPasswordInput"
                    placeholder="Enter password" (keyup.enter)="attemptUnlock()">
                <button class="visibility-toggle" (click)="togglePasswordVisibility()">
                    <!-- Eye Icon (Show) -->
                    <svg *ngIf="!isPasswordVisible" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <!-- Eye Slash Icon (Hide) -->
                    <svg *ngIf="isPasswordVisible" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path
                            d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                        </path>
                        <line x1="1" y1="1" x2="23" y2="23"></line>
                    </svg>
                </button>
            </div>
            <div class="input-line active"></div>

            <button class="unlock-btn" (click)="attemptUnlock()">Unlock</button>

            <div class="locked-footer">
                <a class="forgot-link">Forgot password?</a>
                <p class="logout-hint">Log out and link again from your phone.</p>
                <button class="logout-link" (click)="onLogout()">Log out</button>
            </div>
        </div>
    </div><!-- Theme Selection Modal -->
<div class="modal-overlay" *ngIf="showThemeModal">
    <div class="theme-modal animate-scale-in">
        <h2>Theme</h2>

        <div class="radio-option" (click)="tempTheme = 'Light'">
            <div class="radio-circle">
                <div class="radio-inner" *ngIf="tempTheme === 'Light'"></div>
            </div>
            <span>Light</span>
        </div>

        <div class="radio-option" (click)="tempTheme = 'Dark'">
            <div class="radio-circle">
                <div class="radio-inner" *ngIf="tempTheme === 'Dark'"></div>
            </div>
            <span>Dark</span>
        </div>

        <div class="radio-option" (click)="tempTheme = 'System default'">
            <div class="radio-circle">
                <div class="radio-inner" *ngIf="tempTheme === 'System default'"></div>
            </div>
            <span>System default</span>
        </div>

        <div class="modal-actions">
            <button class="cancel-text-btn" (click)="closeThemeModal()">Cancel</button>
            <button class="ok-btn" (click)="applyTheme()">OK</button>
        </div>
    </div>
</div>
